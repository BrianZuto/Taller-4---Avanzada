<app-layout>
<div class="productos-container">
  <!-- Header -->
  <div class="productos-header">
    <div class="header-content">
      <h1>Productos</h1>
      <p>Gestiona tu catálogo de productos</p>
    </div>
    <button class="btn-nuevo" (click)="abrirModalNuevoProducto()">
      <i class="fas fa-plus"></i>
      Nuevo Producto
    </button>
  </div>

  <!-- Contenido principal -->
  <div class="productos-content">
    <div class="content-header">
      <h2>Lista de Productos</h2>
      <div class="search-container">
        <i class="fas fa-search"></i>
        <input
          type="text"
          placeholder="Buscar producto..."
          [(ngModel)]="busqueda"
          (input)="buscarProductos()"
        >
      </div>
    </div>

    <!-- Tabla de productos -->
    <div class="table-container">
      <table class="productos-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Categoría</th>
            <th>Presentación</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Impuesto</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let producto of productos">
            <td>{{ producto.nombre }}</td>
            <td>
              <span class="categoria-tag">{{ producto.categoriaNombre }}</span>
            </td>
            <td>{{ producto.presentacion }}</td>
            <td class="precio">${{ producto.precio | number:'1.2-2' }}</td>
            <td class="stock">{{ producto.stock }}</td>
            <td class="impuesto">{{ producto.impuesto }}%</td>
            <td class="acciones">
              <button class="btn-edit" (click)="editarProducto(producto)">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-delete" (click)="eliminarProducto(producto.id)"
                      title="Eliminar {{ producto.nombre }}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal para nuevo/editar producto -->
<div class="modal" *ngIf="mostrarModal" (click)="cerrarModal($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ productoEditando ? 'Editar Producto' : 'Nuevo Producto' }}</h3>
      <button class="btn-close" (click)="cerrarModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form (ngSubmit)="guardarProducto()" #productoForm="ngForm">
      <div class="form-group">
        <label for="nombre">Nombre *</label>
        <input
          type="text"
          id="nombre"
          name="nombre"
          [(ngModel)]="productoFormData.nombre"
          required
          maxlength="100"
        >
      </div>

      <div class="form-group">
        <label for="categoria">Categoría *</label>
        <select
          id="categoria"
          name="categoria"
          [(ngModel)]="productoFormData.categoriaId"
          required
        >
          <option value="">Seleccionar categoría</option>
          <option *ngFor="let categoria of categorias" [value]="categoria.id">
            {{ categoria.nombre }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="presentacion">Presentación</label>
        <input
          type="text"
          id="presentacion"
          name="presentacion"
          [(ngModel)]="productoFormData.presentacion"
          maxlength="50"
        >
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="precio">Precio *</label>
          <input
            type="number"
            id="precio"
            name="precio"
            [(ngModel)]="productoFormData.precio"
            required
            min="0"
            step="0.01"
          >
        </div>

        <div class="form-group">
          <label for="stock">Stock</label>
          <input
            type="number"
            id="stock"
            name="stock"
            [(ngModel)]="productoFormData.stock"
            min="0"
          >
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="stockMinimo">Stock Mínimo</label>
          <input
            type="number"
            id="stockMinimo"
            name="stockMinimo"
            [(ngModel)]="productoFormData.stockMinimo"
            min="0"
          >
        </div>

        <div class="form-group">
          <label for="impuesto">Impuesto (%)</label>
          <input
            type="number"
            id="impuesto"
            name="impuesto"
            [(ngModel)]="productoFormData.impuesto"
            min="0"
            max="100"
            step="0.01"
          >
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="cerrarModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-save" [disabled]="!productoForm.valid">
          {{ productoEditando ? 'Actualizar' : 'Crear' }}
        </button>
      </div>
    </form>
  </div>
</div>
</app-layout>
